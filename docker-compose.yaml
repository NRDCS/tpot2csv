version: "2.4"
networks:
   etc_default:
     external: true

services:
  tpot2csv:
    container_name: tpot2csv
    image: tpot2csv
    restart: always
    read_only: true
    env_file: .env
    tmpfs:
      - /tmp
      - /var/tmp
      - /run
    ulimits:
      nofile:
        soft: 512
        hard: 1024
      nproc:
        soft: 256
        hard: 256
    pids_limit: 70
    cpu_shares: 512
    mem_limit: 1g

    build: .
    ports:
      - "65003:443"
    volumes:
      - "/data/nginx/cert/nginx.crt:/usr/local/apache2/conf/server.crt:ro"
      - "/data/nginx/cert/nginx.key:/usr/local/apache2/conf/server.key:ro"
      - "/data/tpot2csv/log:/usr/local/apache2/logs:rw"
      - "/data/tpot2csv/data:/usr/local/apache2/htdocs/data:rw"
    networks:
      - etc_default
    healthcheck:
      test: ["CMD-SHELL", "/usr/bin/wget -O - -q --no-check-certificate --header 'Host:${SERVER_NAME}' https://localhost 2>/dev/null > /dev/null || exit 1"]
      interval: 300s
      timeout: 5s
      start_period: 30s
      

      
      


